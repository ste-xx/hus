<html>
<head>
    <style>
        .side {
            display: grid;
            grid-template-columns: 20px auto auto auto auto auto auto auto auto
        }

        .index {
            justify-self: center;
        }

    </style>
    <script>
      window.define = function (name, required, moduleFn) {
        const require = function () {
          throw new Error("AMD require not supported!")
        };
        const exports = window.define.modules[name] = {};
        const resolved = [require, exports];
        for (var i = 2; i < required.length; i++) {
          const m = window.define.modules[required[i]];
          if (!m) throw new Error("AMD module `" + required[i] + "` not found!");
          resolved.push(m);
        }
        moduleFn.apply(null, resolved);
      };
      window.define.modules = {};
    </script>
    <script src="../dist/app.js"></script>
    <!--    <script src="../dist/game.js"></script>-->
</head>
<body>

<h1>Hus</h1>

<h2> Player 2</h2>
<div class="side">

    <div></div>
    <div class="index">8</div>
    <div class="index">7</div>
    <div class="index">6</div>
    <div class="index">5</div>
    <div class="index">4</div>
    <div class="index">3</div>
    <div class="index">2</div>
    <div class="index">1</div>

    <div> B</div>
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">

    <div> A</div>
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
    <input type="button" class="player1">
</div>

<h2> Player 1</h2>
<div class="side">
    <div> A</div>
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">

    <div> B</div>
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">
    <input type="button" class="player0">

    <div></div>
    <div class="index">1</div>
    <div class="index">2</div>
    <div class="index">3</div>
    <div class="index">4</div>
    <div class="index">5</div>
    <div class="index">6</div>
    <div class="index">7</div>
    <div class="index">8</div>
</div>

<h2>Action Log:</h2>
<div id="actionLog"></div>

<script>


  const eventDispatcher = (event, payload = {}) =>
    document.querySelector('body')
      .dispatchEvent(new CustomEvent(event, {bubbles: true, detail: payload}));

  const eventBus = document.querySelector('body');
  const orgAddEventListener = eventBus.addEventListener;
  eventBus.addEventListener = (event, cb) => orgAddEventListener(event, ({detail}) => cb(detail));
  const setupUi = (game) => {
    const setupFor = (player) => ({
      with: (fields) => {
        fields.forEach(field => field.addEventListener('click', ({target}) =>
          player.take(fields.findIndex(e => e === target))));

        eventBus.addEventListener('endTurn', ({player: {name}}) =>
          fields.forEach((field) => field.disabled = (name === player.name)));
      }
    });

    [...document.querySelectorAll('.player0')].forEach((field) => field.disabled = false);
    [...document.querySelectorAll('.player1')].forEach((field) => field.disabled = true);

    setupFor(game.player0).with([...document.querySelectorAll('.player0')]);
    setupFor(game.player1).with([...document.querySelectorAll('.player1')].reverse());
  };

  const render = (game) => {
    [...document.querySelectorAll('.player0')].forEach((field, index) => field.value = game.player0.getStonesFor(index));
    [...document.querySelectorAll('.player1')].reverse().forEach((field, index) => field.value = game.player1.getStonesFor(index));
  };
  //

  new window.define.modules.ActionLog.HTMLActionLog(eventBus, document.querySelector('#actionLog'));
  // new window.define.modules.ActionLog.ConsoleActionLog(eventBus);
  const game = new window.define.modules.Game.Game(eventDispatcher, eventBus);
  setupUi(game);
  render(game);

  eventBus.addEventListener('endTurn', () => {
    render(game);
  })


</script>

</body>
</html>
